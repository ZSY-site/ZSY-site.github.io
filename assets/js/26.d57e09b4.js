(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{1008:function(t,s,a){t.exports=a.p+"assets/img/91.0d9faa66.png"},1009:function(t,s,a){t.exports=a.p+"assets/img/93.341ae674.png"},1010:function(t,s,a){t.exports=a.p+"assets/img/94.dd8c668b.png"},1011:function(t,s,a){t.exports=a.p+"assets/img/95.b4354fef.png"},1012:function(t,s,a){t.exports=a.p+"assets/img/96.c49a8cbc.png"},1013:function(t,s,a){t.exports=a.p+"assets/img/97.7b5cf312.png"},1014:function(t,s,a){t.exports=a.p+"assets/img/98.5e0ec41f.png"},1015:function(t,s,a){t.exports=a.p+"assets/img/99.c0f620a0.png"},1016:function(t,s,a){t.exports=a.p+"assets/img/100.c80bf94b.png"},1017:function(t,s,a){t.exports=a.p+"assets/img/101.9664d913.png"},1018:function(t,s,a){t.exports=a.p+"assets/img/102.8e08d34d.png"},1019:function(t,s,a){t.exports=a.p+"assets/img/103.943e15e5.png"},1020:function(t,s,a){t.exports=a.p+"assets/img/104.0df59131.png"},1021:function(t,s,a){t.exports=a.p+"assets/img/105.11f9b858.png"},2703:function(t,s,a){"use strict";a.r(s);var n=a(2),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"本地镜像发布到私有库流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本地镜像发布到私有库流程"}},[t._v("#")]),t._v(" 本地镜像发布到私有库流程")]),t._v(" "),n("ul",[n("li",[n("img",{attrs:{src:a(1008),alt:""}})])]),t._v(" "),n("h2",{attrs:{id:"docker-registry-是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-registry-是什么"}},[t._v("#")]),t._v(" Docker Registry 是什么")]),t._v(" "),n("ul",[n("li",[t._v("官方 Docker Hub 地址：https://hub.docker.com/，中国大陆访问官方 Docker Hub 太慢了且准备被阿里云取代的趋势，不太主流。")]),t._v(" "),n("li",[t._v("Dockerhub、阿里云这样的公共镜像仓库可能不太方便，涉及机密的公司不可能提供镜像给公网，所以需要创建一个本地私人仓库供给团队使用，基于公司内部项目构建镜像。")]),t._v(" "),n("li",[t._v("Docker Registry 是官方提供的工具，可以用于构建【私有】镜像仓库")])]),t._v(" "),n("h2",{attrs:{id:"将本地镜像推送到私有库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#将本地镜像推送到私有库"}},[t._v("#")]),t._v(" 将本地镜像推送到私有库")]),t._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载镜像 Docker Registry")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull registry\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行私有库 Registry，相当于本地有个私有 Docker hub")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":5000 "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /zzyyuse/myregistry/:/tmp/registry "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--privileged")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true registry\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("p",[t._v("默认情况，仓库被创建在容器的/var/lib/registry 目录下，建议自行用容器卷映射，方便于宿主机联调")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1009),alt:""}})]),t._v(" "),n("p",[t._v("·案例演示创建一个新镜像，ubuntu 安装 ifconfig 命令\n·从 Hub 上下载 ubuntu 镜像到本地并成功运行\n·原始的 Ubuntu 镜像是不带着 ifconfig 命令的\n"),n("img",{attrs:{src:a(1010),alt:""}})]),t._v(" "),n("p",[t._v("·外网连通的情况下，安装 ifconfig 命令并测试通过")]),t._v(" "),n("p",[t._v("docker 容器内执行上述两条命令：\napt-get update\napt-get install net-tools")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1011),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(1012),alt:""}})]),t._v(" "),n("p",[t._v("·安装完成后，commit 我们自己的新镜像")]),t._v(" "),n("p",[t._v('公式：\ndocker commit -m="提交的描述信息" -a="作者" 容器 ID 要创建的目标镜像名:[标签名]\n命令：在容器外执行，记得\ndocker commit -m="ifconfig cmd add" -a="zzyy" a69d7c825c4f zzyyubuntu:1.2')]),t._v(" "),n("p",[n("img",{attrs:{src:a(1013),alt:""}})]),t._v(" "),n("p",[t._v("·启动我们的新镜像并和原来的对比\n1 官网是默认下载的 Ubuntu 没有 ifconfig 命令\n2 我们自己 commit 构建的新镜像，新增加了 ifconfig 功能，可以成功使用。\n"),n("img",{attrs:{src:a(1014),alt:""}}),t._v("\n·curl 验证私服库上有什么镜像\n curl -XGET http://192.168.111.162:5000/v2/_catalog")]),t._v(" "),n("p",[t._v("可以看到，目前私服库没有任何镜像上传过。。。。。。\n"),n("img",{attrs:{src:a(1015),alt:""}}),t._v("\n·将新镜像 zzyyubuntu:1.2 修改符合私服规范的 Tag")]),t._v(" "),n("p",[t._v("按照公式： docker   tag   镜像:Tag   Host:Port/Repository:Tag\n自己 host 主机 IP 地址，填写同学你们自己的，不要粘贴错误，O(∩_∩)O\n使用命令 docker tag 将 zzyyubuntu:1.2 这个镜像修改为 192.168.111.162:5000/zzyyubuntu:1.2")]),t._v(" "),n("p",[t._v("docker tag  zzyyubuntu:1.2  192.168.111.162:5000/zzyyubuntu:1.2")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1016),alt:""}}),t._v("\n·修改配置文件使之支持 http")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1017),alt:""}})]),t._v(" "),n("p",[t._v("别无脑照着复制，registry-mirrors 配置的是国内阿里提供的镜像加速地址，不用加速的话访问官网的会很慢。\n2 个配置中间有个逗号 ','别漏了，这个配置是 json 格式的。\n2 个配置中间有个逗号 ','别漏了，这个配置是 json 格式的。\n2 个配置中间有个逗号 ','别漏了，这个配置是 json 格式的。")]),t._v(" "),n("p",[t._v("vim 命令新增如下红色内容：vim /etc/docker/daemon.json")]),t._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://aa25jngu.mirror.aliyuncs.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.111.162:5000"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("上述理由：docker 默认不允许 http 方式推送镜像，通过配置选项来取消这个限制。====>  修改完后如果不生效，建议重启 docker\n·push 推送到私服库\ndocker push 192.168.111.162:5000/zzyyubuntu:1.2\n"),n("img",{attrs:{src:a(1018),alt:""}}),t._v("\n·curl 验证私服库上有什么镜像 2\ncurl -XGET http://192.168.111.162:5000/v2/_catalog")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1019),alt:""}}),t._v("\n·pull 到本地并运行\ndocker pull 192.168.111.162:5000/zzyyubuntu:1.2\n"),n("img",{attrs:{src:a(1020),alt:""}})]),t._v(" "),n("p",[t._v("docker run -it 镜像 ID /bin/bash")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1021),alt:""}})])])}),[],!1,null,null,null);s.default=r.exports}}]);