(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{1104:function(s,a,e){s.exports=e.p+"assets/img/53.d21e9d58.png"},1105:function(s,a,e){s.exports=e.p+"assets/img/54.c47d7eff.png"},1106:function(s,a,e){s.exports=e.p+"assets/img/55.1cc89f63.png"},1107:function(s,a,e){s.exports=e.p+"assets/img/56.a39511cf.png"},2709:function(s,a,e){"use strict";e.r(a);var n=e(2),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"service-概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service-概述"}},[s._v("#")]),s._v(" Service 概述")]),s._v(" "),n("p",[s._v("Service 是 Kubernetes 最核心概念，通过创建 Service,可以为一组具有相同功能的容器应\n用提供一个统一的入口地 址，并且将请求负载分发到后端的各个容器应用上。")]),s._v(" "),n("h2",{attrs:{id:"service-的定义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service-的定义"}},[s._v("#")]),s._v(" Service 的定义")]),s._v(" "),n("p",[s._v("（1）yaml 格式的 Service 定义文件")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("apiVersion: v1 kind: Service matadata:\nname: string namespace: string labels:\n-name: string annotations:\n-name: string spec:\nselector: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" type: string clusterIP: string\nsessionAffinity: string ports:\n-name: string protocol: string port: int targetPort: int nodePort: int\nstatus: loadBalancer:\ningress:\nip: string hostname: string\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("img",{attrs:{src:e(1104),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:e(1105),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:e(1106),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:e(1107),alt:""}})]),s._v(" "),n("h2",{attrs:{id:"service-的基本用法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#service-的基本用法"}},[s._v("#")]),s._v(" Service 的基本用法")]),s._v(" "),n("p",[s._v("（1）一般来说，对外提供服务的应用程序需要通过某种机制来实现，对于容器应用最简便\n的方式就是通过 TCP/IP 机制及 监听 IP 和端口号来实现。创建一个基本功能的 Service")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("apiVersion: v1\nkind: ReplicationController metadata:\nname: mywebapp spec:\nreplicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" template:\nmetadata:\nname: mywebapp labels:\napp: mywebapp spec:\ncontainers:\n-name: mywebapp image: tomcat ports:\n-containerPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("（2）我们可以通过 kubectl get pods -l app=mywebapp -o yaml | grep podIP 来获取\nPod 的 IP 地址和端口号来访问 Tomcat 服务，但是直接通过 Pod 的 IP 地址和端口访问应用\n服务是不可靠的，因为当 Pod 所在的 Node 发生故障时， Pod 将被 kubernetes 重新调度到\n另一台 Node，Pod 的地址会发生改变。我们可以通过配置文件来定义 Service，再 通过\nkubectl create 来创建，这样可以通过 Service 地址来访问后端的 Pod.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("apiVersion: v1 kind: Service metadata:\nname: mywebAppService spec:\nports:\n- port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v("\ntargetPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" selector:\napp: mywebapp\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"多端口-service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多端口-service"}},[s._v("#")]),s._v(" 多端口 Service")]),s._v(" "),n("p",[s._v("有时一个容器应用也可能需要提供多个端口的服务，那么在 Service 的定义中也可以相应\n地设置为将多个端口对应 到多个应用服务。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("apiVersion: v1 kind: Service metadata:\nname: mywebAppService spec:\nports:\n- port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\ntargetPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" name: web\n- port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8005")]),s._v("\ntargetPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8005")]),s._v(" name: management\nselector:\napp: mywebapp\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"外部服务-service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#外部服务-service"}},[s._v("#")]),s._v(" 外部服务 Service")]),s._v(" "),n("p",[s._v("在某些特殊环境中，应用系统需要将一个外部数据库作为后端服务进行连接，或将另一个\n集群或 Namespace 中的 服务作为服务的后端，这时可以通过创建一个无 Label Selector\n的 Service 来实现。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("apiVersion: v1 kind: Service metadata:\nname: my-service spec:\nports:\n- protocol: TCP port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\ntargetPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n--------------------------\napiVersion: v1\nkind: Endpoints metadata:\nname: my-service subsets:\n- addresses:\n- IP: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.254")]),s._v(".74.3\nports:\n- port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);