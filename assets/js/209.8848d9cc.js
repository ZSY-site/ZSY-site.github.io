(window.webpackJsonp=window.webpackJsonp||[]).push([[209],{2361:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"创建本地项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建本地项目"}},[s._v("#")]),s._v(" 创建本地项目")]),s._v(" "),n("ul",[n("li",[s._v("先登录git服务器创建php仓库")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /home/git/repos/dev-php.git\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/git/repos/dev-php.git\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bare")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"拉取代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拉取代码"}},[s._v("#")]),s._v(" 拉取代码")]),s._v(" "),n("ul",[n("li",[s._v("拉取并初始化本地仓库")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone  git@192.168.20.131:/home/git/repos/dev-php.git\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" php\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<?php echo info()?>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" index.php\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add index.php"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin master\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"部署环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署环境"}},[s._v("#")]),s._v(" 部署环境")]),s._v(" "),n("ul",[n("li",[s._v("安装php")]),s._v(" "),n("li",[s._v("安装nginx")])]),s._v(" "),n("h2",{attrs:{id:"创建项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[s._v("#")]),s._v(" 创建项目")]),s._v(" "),n("h3",{attrs:{id:"构建参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建参数"}},[s._v("#")]),s._v(" 构建参数")]),s._v(" "),n("p",[n("img",{attrs:{src:t(766),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(767),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"pipeline脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pipeline脚本"}},[s._v("#")]),s._v(" pipeline脚本")]),s._v(" "),n("ul",[n("li",[s._v("先在git服务器里创建一个dev-php项目")]),s._v(" "),n("li",[s._v("然后到web服务器上克隆此项目并在里面添加文件")]),s._v(" "),n("li",[s._v("在pipeline服务器里添加新的脚本")]),s._v(" "),n("li",[s._v("给web服务器添加标签名并在pipeline脚本中引用")]),s._v(" "),n("li",[s._v("web服务器上的工作目录 /var/lib/jenkins/workspace/dev-php")]),s._v(" "),n("li",[s._v("credentialsId git/git")])]),s._v(" "),n("p",[s._v("cat /root/pipeline/Jenkinsfile-php")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webserver'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'checkout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       checkout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*/master'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", doGenerateSubmoduleConfigurations: false, extensions: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", submoduleCfg: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", userRemoteConfigs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8e8e63f9-4806-4f2e-8633-c92badbdefd7'")]),s._v(", url: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git@192.168.20.131:/home/git/repos/'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('.git"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'rm "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/.git\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" /data/backup "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /data/backup\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" /usr/share/nginx/html/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/share/nginx/html/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/share/nginx/html/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v(" /data/backup/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-'),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%F_%T"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v(" /usr/share/nginx/html"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl http://www.'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('.com/status"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports},766:function(s,a,t){s.exports=t.p+"assets/img/18.56cd7d54.png"},767:function(s,a,t){s.exports=t.p+"assets/img/19.6e04ca54.png"}}]);