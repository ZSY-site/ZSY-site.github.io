(window.webpackJsonp=window.webpackJsonp||[]).push([[328],{2630:function(a,s,t){"use strict";t.r(s);var n=t(2),r=Object(n.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h2",{attrs:{id:"前话"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前话"}},[a._v("#")]),a._v(" 前话")]),a._v(" "),n("ul",[n("li",[a._v("Monorepo 是管理项目代码的一个方式，指在一个项目仓库(repo)中管理多个模块/包(package)")]),a._v(" "),n("li",[a._v("monorepo 最主要的好处是统一的工作流和代码共享")]),a._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/lerna/lerna",target:"_blank",rel:"noopener noreferrer"}},[a._v("Lerna"),n("OutboundLink")],1),a._v(" 是一个管理多个 npm 模块的工具, 优化维护多包的工作流，解决多个包互相依赖，且发布需要手动维护多个包的问题")]),a._v(" "),n("li",[n("a",{attrs:{href:"https://classic.yarnpkg.com/en/docs/cli/",target:"_blank",rel:"noopener noreferrer"}},[a._v("yarn"),n("OutboundLink")],1)])]),a._v(" "),n("h2",{attrs:{id:"multirepo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#multirepo"}},[a._v("#")]),a._v(" MultiRepo")]),a._v(" "),n("h3",{attrs:{id:"优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[a._v("#")]),a._v(" 优点")]),a._v(" "),n("ul",[n("li",[a._v("各模块的管理自由度较高，可以自行选择构建工具、依赖管理、单元测试等配套设施")]),a._v(" "),n("li",[a._v("各模块的体积也不会太大")])]),a._v(" "),n("h3",{attrs:{id:"缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[a._v("#")]),a._v(" 缺点")]),a._v(" "),n("ul",[n("li",[a._v("仓库分散不好找，分支管理混乱")]),a._v(" "),n("li",[a._v("版本更新繁琐，如果公共模块发生了变化，需要对所有的模块进行依赖更新")]),a._v(" "),n("li",[a._v("CHANGELOG不好梳理，无法自动关联各个模块的变动")])]),a._v(" "),n("h2",{attrs:{id:"monorepo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#monorepo"}},[a._v("#")]),a._v(" MonoRepo")]),a._v(" "),n("h3",{attrs:{id:"优点-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优点-2"}},[a._v("#")]),a._v(" 优点")]),a._v(" "),n("ul",[n("li",[a._v("一个仓库维护多个模块，方便好找")]),a._v(" "),n("li",[a._v("方便版本管理和依赖管理，模块之间的引用调试都比较方便")]),a._v(" "),n("li",[a._v("方便统一生成CHANGELOG")])]),a._v(" "),n("h3",{attrs:{id:"缺点-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缺点-2"}},[a._v("#")]),a._v(" 缺点")]),a._v(" "),n("ul",[n("li",[a._v("统一构建工具, 需要构建工具能构建所的模块")]),a._v(" "),n("li",[a._v("仓库体积变大")])]),a._v(" "),n("h2",{attrs:{id:"使用lerna"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用lerna"}},[a._v("#")]),a._v(" 使用lerna")]),a._v(" "),n("h3",{attrs:{id:"安装lerna"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装lerna"}},[a._v("#")]),a._v(" 安装lerna")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" i lerna "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),a._v("\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("h3",{attrs:{id:"初始化项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初始化项目"}},[a._v("#")]),a._v(" 初始化项目")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" lerna-project\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" lerna-project\n\nlerna init\nlerna notice cli v4.0.0\nlerna info Initializing Git repository\nlerna info Creating package.json\nlerna info Creating lerna.json\nlerna info Creating packages directory\nlerna success Initialized Lerna files\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br")])]),n("p",[n("img",{attrs:{src:t(881),alt:""}})]),a._v(" "),n("h3",{attrs:{id:"package-json"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#package-json"}},[a._v("#")]),a._v(" package.json")]),a._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"private"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 私有的,用来管理整个项目,不会被发布到npm")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"devDependencies"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"lerna"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"^4.0.0"')]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br")])]),n("h3",{attrs:{id:"lerna-json"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lerna-json"}},[a._v("#")]),a._v(" lerna.json")]),a._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"packages"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"packages/*"')]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"version"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0.0.0"')]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br")])]),n("h3",{attrs:{id:"yarn-workspace"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#yarn-workspace"}},[a._v("#")]),a._v(" yarn workspace")]),a._v(" "),n("ul",[n("li",[a._v("yarn workspace允许我们使用 monorepo 的形式来管理项目")]),a._v(" "),n("li",[a._v("在安装 node_modules 的时候它不会安装到每个子项目的 node_modules 里面，而是直接安装到根目录下面，这样每个子项目都可以读取到根目录的 node_modules")]),a._v(" "),n("li",[a._v("整个项目只有根目录下面会有一份 yarn.lock 文件。子项目也会被 link 到 node_modules 里面，这样就允许我们就可以直接用 import 导入对应的项目")]),a._v(" "),n("li",[a._v("yarn.lock文件是自动生成的,也完全Yarn来处理.yarn.lock锁定你安装的每个依赖项的版本，这可以确保你不会意外获得不良依赖")])]),a._v(" "),n("h3",{attrs:{id:"开启workspace"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开启workspace"}},[a._v("#")]),a._v(" 开启workspace")]),a._v(" "),n("p",[a._v("package.json")]),a._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"private"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" \n+  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"workspaces"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n+    "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"packages/*"')]),a._v("\n+  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"devDependencies"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[a._v('"lerna"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"^3.22.1"')]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br")])]),n("h3",{attrs:{id:"创建子项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建子项目"}},[a._v("#")]),a._v(" 创建子项目")]),a._v(" "),n("ul",[n("li",[a._v("react是React核心，包含了React.createElement等代码")]),a._v(" "),n("li",[a._v("shared 存放各个模块公用的全局变量和方法")]),a._v(" "),n("li",[a._v("scheduler 实现了优先级调度功能")]),a._v(" "),n("li",[a._v("react-reconciler 提供了协调器的功能")]),a._v(" "),n("li",[a._v("react-dom 提供了渲染到DOM的功能")])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("lerna create react\nlerna create shared\nlerna create scheduler\nlerna create react-reconciler\nlerna create react-dom\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br")])]),n("h3",{attrs:{id:"添加依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加依赖"}},[a._v("#")]),a._v(" 添加依赖")]),a._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://classic.yarnpkg.com/en/docs/cli",target:"_blank",rel:"noopener noreferrer"}},[a._v("yarnpkg"),n("OutboundLink")],1)]),a._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/lerna/lerna#readme",target:"_blank",rel:"noopener noreferrer"}},[a._v("lerna"),n("OutboundLink")],1)])]),a._v(" "),n("h4",{attrs:{id:"置加速镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#置加速镜像"}},[a._v("#")]),a._v(" 置加速镜像")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" config get registry\n"),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" registry http://registry.npm.taobao.org/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" registry http://registry.npmjs.org/\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("h3",{attrs:{id:"常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),n("h4",{attrs:{id:"根空间添加依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#根空间添加依赖"}},[a._v("#")]),a._v(" 根空间添加依赖")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" chalk --ignore-workspace-root-check\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("h4",{attrs:{id:"给某个项目添加依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#给某个项目添加依赖"}},[a._v("#")]),a._v(" 给某个项目添加依赖")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" workspace react "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" object-assign\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("h4",{attrs:{id:"安装和link"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装和link"}},[a._v("#")]),a._v(" 安装和link")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v("\nlerna bootstrap --npm-client "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v(" --use-workspaces\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("h4",{attrs:{id:"其它命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其它命令"}},[a._v("#")]),a._v(" 其它命令")]),a._v(" "),n("table",[n("thead",[n("tr",[n("th",[a._v("作用")]),a._v(" "),n("th",[a._v("命令")])])]),a._v(" "),n("tbody",[n("tr",[n("td",[a._v("查看工作空间信息")]),a._v(" "),n("td",[a._v("yarn workspaces info")])]),a._v(" "),n("tr",[n("td",[a._v("删除所有的 node_modules")]),a._v(" "),n("td",[a._v("lerna clean 等于 yarn workspaces run clean")])]),a._v(" "),n("tr",[n("td",[a._v("重新获取所有的 node_modules")]),a._v(" "),n("td",[a._v("yarn install --force")])]),a._v(" "),n("tr",[n("td",[a._v("查看缓存目录")]),a._v(" "),n("td",[a._v("yarn cache dir")])]),a._v(" "),n("tr",[n("td",[a._v("清除本地缓存")]),a._v(" "),n("td",[a._v("yarn cache clean")])])])])])}),[],!1,null,null,null);s.default=r.exports},881:function(a,s,t){a.exports=t.p+"assets/img/305.10b8d285.png"}}]);