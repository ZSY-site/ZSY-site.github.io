(window.webpackJsonp=window.webpackJsonp||[]).push([[892],{2708:function(s,e,a){"use strict";a.r(e);var n=a(2),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"secret-存在意义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secret-存在意义"}},[s._v("#")]),s._v(" Secret 存在意义")]),s._v(" "),a("p",[s._v("Secret 解决了密码、token、密钥等敏感数据的配置问题，而不需要把这些敏感数据暴露\n到镜像或者 Pod Spec 中。Secret 可以以 Volume 或者环境变量的方式使用")]),s._v(" "),a("h2",{attrs:{id:"secret-有三种类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secret-有三种类型"}},[s._v("#")]),s._v(" Secret 有三种类型")]),s._v(" "),a("p",[s._v("• Service Account :用来访问 Kubernetes API,由 Kubernetes 自动创建，并且会自动挂\n载到 Pod 的\n/run/secrets/kubernetes.io/serviceaccount 目录中\n• Opaque : base64 编码格式的 Secret,用来存储密码、密钥等\n• kubernetes.io/dockerconfigjson ：用来存储私有 docker registry 的认证信息")]),s._v(" "),a("h2",{attrs:{id:"service-account"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-account"}},[s._v("#")]),s._v(" Service Account")]),s._v(" "),a("p",[s._v("Service Account 用来访问 Kubernetes API,甶 Kubernetes 自动创建，并且会自动挂载到\nPod 的/run/secrets/kubernetes.io/serviceaccount 目录中")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ kubectl run nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v(" nginx\ndeployment "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(" created\n$ kubectl get pods\nNAME READY STATUS RESTARTS AGE\nnginx-3137573019-md1u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 Running "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 13s\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" nginx-3137573019-md1u2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n/run/secrets/kubernetes.io/serviceaccount\nca.crt\nnamespace\ntoken\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"opaque-secret"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opaque-secret"}},[s._v("#")]),s._v(" Opaque Secret")]),s._v(" "),a("p",[s._v("（1）创建说明：Opaque 类型的数据是一个 map 类型，要求 value 是 base64 编码格式")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("YWRtaW4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1f2d1e2e67df"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64\nMWYyZDFlMmU2N2Rm:\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("（2）secrets.yml")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Secret\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysecret\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Opaque\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MWYyZDFlMmU2N2Rm\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" YWRtaW4=\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("（3）使用方式\n将 Secret 挂载到 Volume 中")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v('apiVersion: v1\nkind: Pod\nmetadata:\nlabels:\nname: seret-test\nname: seret-test\nspec:\nvolumes:\n- name: secrets\nsecret:\nsecretName: mysecret\ncontainers:\n-image: hub.atguigu.com/library/myapp:v1\nname: db\nvolumeMounts:\n- name: secrets\nmountPath:"\nreadOnly: '),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("将 Secret 导出到环境变量中")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\nname: pod-deployment\nspec:\nreplicas: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\ntemplate:\nmetadata:\nlabels:\napp: pod-deployment\nspec:\ncontainers:\n- name: pod-1\nimage: hub.atguigu.com/library/myapp:v1\nports:\n-containerPort: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nenv:\n-name: TEST_USER\nvalueFrom:\nsecretKeyRef:\nname: mysecret\nkey: username\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h2",{attrs:{id:"kubernetes-io-dockerconfigjson"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-io-dockerconfigjson"}},[s._v("#")]),s._v(" kubernetes.io/dockerconfigjson")]),s._v(" "),a("p",[s._v("使用 Kuberctl 创建 docker registry 认证的 secret")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ kubectl create secret docker-registry myregistrykey --dockerserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DOCKER_REGISTRY_SERVER -- docker-username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DOCKER_USER --dockerpassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DOCKER_PASSWORD --docker-email"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DOCKER_EMAIL secret "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myregistrykey"')]),s._v("\ncreated.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在创建 Pod 的时候，通过 imagePullSecrets 来引用刚创建的'myregistrykey")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\nname: foo\nspec:\ncontainers:\n- name: foo\nimage: roc/awangyang:v1\nimagePullSecrets:\n-name: myregistrykey\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);