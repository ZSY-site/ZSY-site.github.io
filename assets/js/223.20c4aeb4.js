(window.webpackJsonp=window.webpackJsonp||[]).push([[223],{1128:function(s,a,n){s.exports=n.p+"assets/img/73.0c765d01.png"},1129:function(s,a,n){s.exports=n.p+"assets/img/74.4dcf94ef.png"},2716:function(s,a,n){"use strict";n.r(a);var t=n(2),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"helm-引入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-引入"}},[s._v("#")]),s._v(" Helm 引入")]),s._v(" "),t("p",[s._v("K8S 上的应用对象，都是由特定的资源描述组成，包括 deployment、service 等。都保存\n各自文件中或者集中写到一个配置文件。然后 kubectl apply –f 部署。如果应用只由一\n个或几个这样的服务组成，上面部署方式足够了。而对于一个复杂的应用，会有很多类似\n上面的资源描述文件，例如微服务架构应用，组成应用的服务可能多达十个，几十个。如\n果有更新或回滚应用的需求，可能要修改和维护所涉及的大量资源文件，而这种组织和管\n理应用的方式就显得力不从心了。且由于缺少对发布过的应用版本管理和控制，使\nKubernetes 上的应用维护和更新等面临诸多的挑战，主要面临以下问题：（1）如何将这\n些服务作为一个整体管理 （2）这些资源文件如何高效复用 （3）不支持应用级别的版本\n管理")]),s._v(" "),t("h2",{attrs:{id:"helm-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-介绍"}},[s._v("#")]),s._v(" Helm 介绍")]),s._v(" "),t("p",[s._v("Helm 是一个 Kubernetes 的包管理工具，就像 Linux 下的包管理器，如 yum/apt 等，可以\n很方便的将之前打包好的 yaml 文件部署到 kubernetes 上。\nHelm 有 3 个重要概念：\n（1）helm：一个命令行客户端工具，主要用于 Kubernetes 应用 chart 的创建、打包、发\n布和管理。\n（2）Chart：应用描述，一系列用于描述 k8s 资源相关文件的集合。\n（3）Release：基于 Chart 的部署实体，一个 chart 被 Helm 运行后将会生成对应的一个\nrelease；将在 k8s 中创建出真实运行的资源对象。")]),s._v(" "),t("h2",{attrs:{id:"helm-v3-变化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-v3-变化"}},[s._v("#")]),s._v(" Helm v3 变化")]),s._v(" "),t("p",[s._v("2019 年 11 月 13 日， Helm 团队发布 Helm v3 的第一个稳定版本。\n该版本主要变化如下：\n架构变化：\n1、最明显的变化是 Tiller 的删除")]),s._v(" "),t("p",[t("img",{attrs:{src:n(1128),alt:""}})]),s._v(" "),t("p",[s._v("2、Release 名称可以在不同命名空间重用\n3、支持将 Chart 推送至 Docker 镜像仓库中\n4、使用 JSONSchema 验证 chart values\n5、其他")]),s._v(" "),t("h2",{attrs:{id:"helm-客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-客户端"}},[s._v("#")]),s._v(" Helm 客户端")]),s._v(" "),t("h3",{attrs:{id:"部署-helm-客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署-helm-客户端"}},[s._v("#")]),s._v(" 部署 helm 客户端")]),s._v(" "),t("p",[s._v("Helm 客户端下载地址：https://github.com/helm/helm/releases\n解压移动到/usr/bin/目录即可。\nwget https://get.helm.sh/helm-vv3.2.1-linux-amd64.tar.gz\ntar zxvf helm-v3.2.1-linux-amd64.tar.gz\nmv linux-amd64/helm /usr/bin/")]),s._v(" "),t("p",[s._v("helm 常用命令")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("命令")]),s._v(" "),t("th",[s._v("描述")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("create")]),s._v(" "),t("td",[s._v("创建一个 chart 并指定名字")])]),s._v(" "),t("tr",[t("td",[s._v("dependency")]),s._v(" "),t("td",[s._v("管理 chart 依赖")])]),s._v(" "),t("tr",[t("td",[s._v("get")]),s._v(" "),t("td",[s._v("下载一个 release。可用子命令：all、hooks、manifest、notes、values")])]),s._v(" "),t("tr",[t("td",[s._v("history")]),s._v(" "),t("td",[s._v("获取 release 历史")])]),s._v(" "),t("tr",[t("td",[s._v("install")]),s._v(" "),t("td",[s._v("安装一个 chart")])]),s._v(" "),t("tr",[t("td",[s._v("list")]),s._v(" "),t("td",[s._v("列出 release")])]),s._v(" "),t("tr",[t("td",[s._v("package")]),s._v(" "),t("td",[s._v("将 chart 目录打包到 chart 存档文件中")])]),s._v(" "),t("tr",[t("td",[s._v("pull")]),s._v(" "),t("td",[s._v("从远程仓库中下载 chart 并解压到本地 # helm pull stable/mysql --")])]),s._v(" "),t("tr",[t("td",[s._v("repo")]),s._v(" "),t("td",[s._v("添加，列出，移除，更新和索引 chart 仓库。可用子命令：add、index、list、remove、update")])]),s._v(" "),t("tr",[t("td",[s._v("rollback")]),s._v(" "),t("td",[s._v("从之前版本回滚")])]),s._v(" "),t("tr",[t("td",[s._v("search")]),s._v(" "),t("td",[s._v("根据关键字搜索 chart。可用子命令：hub、repo")])]),s._v(" "),t("tr",[t("td",[s._v("show")]),s._v(" "),t("td",[s._v("查看 chart 详细信息。可用子命令：all、chart、readme、values")])]),s._v(" "),t("tr",[t("td",[s._v("status")]),s._v(" "),t("td",[s._v("显示已命名版本的状态")])]),s._v(" "),t("tr",[t("td",[s._v("template")]),s._v(" "),t("td",[s._v("本地呈现模板")])]),s._v(" "),t("tr",[t("td",[s._v("uninstall")]),s._v(" "),t("td",[s._v("卸载一个 release")])]),s._v(" "),t("tr",[t("td",[s._v("upgrade")]),s._v(" "),t("td",[s._v("更新一个 release")])]),s._v(" "),t("tr",[t("td",[s._v("version")]),s._v(" "),t("td",[s._v("查看 helm 客户端版本")])])])]),s._v(" "),t("h3",{attrs:{id:"配置国内-chart-仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置国内-chart-仓库"}},[s._v("#")]),s._v(" 配置国内 chart 仓库")]),s._v(" "),t("p",[s._v(" 微软仓库（http://mirror.azure.cn/kubernetes/charts/）这个仓库推荐，基本\n上官网有的 chart 这里都有。\n 阿里云仓库（https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts ）\n官方仓库（https://hub.kubeapps.com/charts/incubator）官方 chart 仓库，国\n内有点不好使。")]),s._v(" "),t("p",[s._v("添加存储库\nhelm repo add stable http://mirror.azure.cn/kubernetes/charts\nhelm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts\nhelm repo update")]),s._v(" "),t("p",[s._v("查看配置的存储库\nhelm repo list\nhelm search repo stable")]),s._v(" "),t("p",[s._v("删除存储库：\nhelm repo remove aliyun")]),s._v(" "),t("h2",{attrs:{id:"helm-基本使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-基本使用"}},[s._v("#")]),s._v(" helm 基本使用")]),s._v(" "),t("p",[s._v("主要介绍三个命令：\n chart install\n chart upgrade\n chart rollback")]),s._v(" "),t("h3",{attrs:{id:"使用-chart-部署一个应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-chart-部署一个应用"}},[s._v("#")]),s._v(" 使用 chart 部署一个应用")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查找 chart")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm search repo weave")]),s._v("\nNAME CHART VERSION APP VERSION DESCRIPTION\naliyun/weave-cloud "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".2 Weave Cloud is a add-on\nto Kubernetes "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" pro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\naliyun/weave-scope "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v(".21.6.5 A Helm chart "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the Weave Scope\ncluster visual"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nstable/weave-cloud "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(".71.4.0 Weave Cloud is a add-on to Kubernetes\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" pro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nstable/weave-scope "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".101.12.0 A Helm chart "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the Weave Scope\ncluster visual"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看 chrt 信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm show chart stable/mysql")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install ui stable/weave-scope")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看发布状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm list")]),s._v("\nNAME NAMESPACE REVISION UPDATED\nSTATUS CHART APP VERSION\nui default "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12020")]),s._v("-05-2817:45:01.696109626 +0800 CST deployed\nweave-scope-1.1.101.12.0\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm status ui")]),s._v("\nNAME: ui\nLAST DEPLOYED: Thu May "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2817")]),s._v(":45:012020\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nNOTES:\nYou should now be able to access the Scope frontend "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your web browser, by\nusing kubectl port-forward:\nkubectl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" default port-forward "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" default get endpoints "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nui-weave-scope "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.subsets[0].addresses[0].targetRef.name}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":4040\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" browsing to http://localhost:8080/.\nFor "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" details on using Weave Scope, see the Weave Scope documentation:\nhttps://www.weave.works/docs/scope/latest/introducing/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改 service Type: NodePort 即可访问 ui")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("h3",{attrs:{id:"安装前自定义-chart-配置选项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装前自定义-chart-配置选项"}},[s._v("#")]),s._v(" 安装前自定义 chart 配置选项")]),s._v(" "),t("p",[s._v("自定义选项是因为并不是所有的 chart 都能按照默认配置运行成功，可能会需要一些环境\n依赖，例如 PV。\n所以我们需要自定义 chart 配置选项，安装过程中有两种方法可以传递配置数据：\n --values（或-f）：指定带有覆盖的 YAML 文件。这可以多次指定，最右边的文件\n优先\n --set：在命令行上指定替代。如果两者都用，--set 优先级高\n--values 使用，先将修改的变量写到一个文件中")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm show values stable/mysql")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catconfig.yaml")]),s._v("\npersistence:\nenabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nstorageClass: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"managed-nfs-storage"')]),s._v("\naccessMode: ReadWriteOnce\nsize: 8Gi\nmysqlUser: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),s._v("\nmysqlPassword: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\nmysqlDatabase: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install db -f config.yaml stable/mysql")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods")]),s._v("\nNAME READY STATUS RESTARTS AGE\ndb-mysql-57485b68dc-4xjhv "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 8m51s\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl run -it db-client --rm --restart=Never --image=mysql:5.7 -- bash")]),s._v("\nIf you don"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t see a command prompt, try pressing enter.\nroot@db-client:/# mysql -hdb-mysql -uk8s -p123456\nmysql: [Warning] Using a password on the command line interface can be insecure.\nWelcome to the MySQL monitor. Commands end with ; or \\g.\nYour MySQL connection id is 36\nServer version: 5.7.30 MySQL Community Server (GPL)\nCopyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\nType '")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' or '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'for help. Type '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("c' to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("clear")]),s._v(" the current input statement.\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show databases"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Database "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" k8s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[s._v("以上将创建具有名称的默认 MySQL 用户 k8s，并授予此用户访问新创建的 k8s 数据库的权\n限，但将接受该图表的所有其余默认值。")]),s._v(" "),t("p",[s._v("命令行替代变量：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# helm install db --set persistence.storageClass="managed-nfs-storage"')]),s._v("\nstable/mysql\n也可以把 chart 包下载下来查看详情：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm pull stable/mysql --untar")]),s._v("\nvalues yaml 与 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" 使用：\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("img",{attrs:{src:n(1129),alt:""}}),s._v("\n该 helm install 命令可以从多个来源安装：\n chart 存储库\n 本地 chart 存档（helm install foo-0.1.1.tgz）\n chart 目录（helm install path/to/foo）\n 完整的 URL（helm install https://example.com/charts/foo-1.2.3.tgz）")]),s._v(" "),t("h2",{attrs:{id:"构建一个-helm-chart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建一个-helm-chart"}},[s._v("#")]),s._v(" 构建一个 Helm Chart")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm create mychart")]),s._v("\nCreating mychart\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree mychart/")]),s._v("\nmychart/\n├── charts\n├── Chart.yaml\n├── templates\n│ ├── deployment.yaml\n│ ├── _helpers.tpl\n│ ├── ingress.yaml\n│ ├── NOTES.txt\n│ └── service.yaml\n└── values.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v(" Chart.yaml：用于描述这个 Chart 的基本信息，包括名字、描述信息以及版本等。\n values.yaml ：用于存储 templates 目录中模板文件中用到变量的值。\n Templates： 目录里面存放所有 yaml 模板文件。\n charts：目录里存放这个 chart 依赖的所有子 chart。\n NOTES.txt ：用于介绍 Chart 帮助信息， helm install 部署后展示给用户。例如：\n如何使用这个 Chart、列出缺省的设置等。\n _helpers.tpl：放置模板助手的地方，可以在整个 chart 中重复使用\n创建 Chart 后，接下来就是将其部署：\nhelm install web mychart/\n也可以打包推送的 charts 仓库共享别人使用。")]),s._v(" "),t("ul",[t("li",[s._v("helm package mychart/")])]),s._v(" "),t("p",[s._v("mychart-0.1.0.tgz")]),s._v(" "),t("h3",{attrs:{id:"chart-模板"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-模板"}},[s._v("#")]),s._v(" chart 模板")]),s._v(" "),t("p",[s._v("Helm 最核心的就是模板，即模板化的 K8S manifests 文件。\n它本质上就是一个 Go 的 template 模板。Helm 在 Go template 模板的基础上，还会增加很\n多东西。如一些自定义的元数据信息、扩展的库以及一些类似于编程形式的工作流，例如\n条件语句、管道等等。这些东西都会使得我们的模板变得更加丰富。\n有了模板，我们怎么把我们的配置融入进去呢？用的就是这个 values 文件。这两部分内容\n其实就是 chart 的核心功能。\n接下来，部署 nginx 应用，熟悉模板使用")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm create nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim nginx/Chart.yaml")]),s._v("\napiVersion: v2\nname: nginx\ndescription: A Helm chart "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Kubernetes\ntype: application\nversion: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".0\nappVersion: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim nginx/values.yaml")]),s._v("\nreplicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nimage: nginx\ntag: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v("\nserviceport: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\ntargetport: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nlabel: nginx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim nginx/templates/NOTES.txt")]),s._v("\nhello\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim nginx/templates/deployment.yaml")]),s._v("\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.label "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nspec:\nreplicas: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.replicas "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nselector:\nmatchLabels:\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.label "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ntemplate:\nmetadata:\nlabels:\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.label "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nspec:\ncontainers:\n- image: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.image "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.tag "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nname: web\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim nginx/templates/service.yaml")]),s._v("\napiVersion: v1\nkind: Service\nmetadata:\nlabels:\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.label "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nspec:\nports:\n- port: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.serviceport "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nprotocol: TCP\ntargetPort: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.targetport "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nselector:\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.label "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ntype: NodePort\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看实际的模板被渲染过后的资源文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm get manifest web")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install web nginx/")]),s._v("\nNAME: web\nLAST DEPLOYED: Fri May "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2916")]),s._v(":09:462020\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nTEST SUITE: None\nNOTES:\nhello\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm list")]),s._v("\nNAME NAMESPACE REVISION UPDATED\nSTATUS CHART APP VERSION\nweb default "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12020")]),s._v("-05-2916:09:46.608457282 +0800 CST deployed\nnginx-0.1.01.15\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br")])]),t("p",[s._v("NAME READY STATUS RESTARTS AGE\nweb-5675686b8-7wtqk 1/1 Running 0 25s\nweb-5675686b8-f72hk 1/1 Running 0 25s\nweb-5675686b8-k4kqr 1/1 Running 0 25s\n这个 deployment 就是一个 Go template 的模板，这里定义的 Release 模板对象属于 Helm\n内置的一种对象，是从 values 文件中读取出来的。这样一来，我们可以将需要变化的地方\n都定义变量。")]),s._v(" "),t("h3",{attrs:{id:"调试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调试"}},[s._v("#")]),s._v(" 调试")]),s._v(" "),t("p",[s._v("Helm 也提供了--dry-run --debug 调试参数，帮助你验证模板正确性。在执行 helm\ninstall 时候带上这两个参数就可以把对应的 values 值和渲染的资源清单打印出来，而不\n会真正的去部署一个 release。\n比如我们来调试上面创建的 chart 包：")]),s._v(" "),t("ul",[t("li",[s._v("helm install web --dry-run nginx/")])]),s._v(" "),t("h3",{attrs:{id:"内置对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内置对象"}},[s._v("#")]),s._v(" 内置对象")]),s._v(" "),t("p",[s._v("是 Helm 的内置对象，下面是一些常用的内置对象：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("Release.Name")]),s._v(" "),t("th",[s._v("release 名称")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Release.Name")]),s._v(" "),t("td",[s._v("release 名字")])]),s._v(" "),t("tr",[t("td",[s._v("Release.Namespace")]),s._v(" "),t("td",[s._v("release 命名空间")])]),s._v(" "),t("tr",[t("td",[s._v("Release.Service")]),s._v(" "),t("td",[s._v("release 服务的名称")])]),s._v(" "),t("tr",[t("td",[s._v("Release.Revision")]),s._v(" "),t("td",[s._v("release 修订版本号，从 1 开始累加")])])])]),s._v(" "),t("h3",{attrs:{id:"values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#values"}},[s._v("#")]),s._v(" Values")]),s._v(" "),t("p",[s._v("Values 对象是为 Chart 模板提供值，这个对象的值有 4 个来源：\n chart 包中的 values.yaml 文件\n 父 chart 包的 values.yaml 文件\n 通过 helm install 或者 helm upgrade 的 -f 或者 --values 参数传入的自定\n义的 yaml 文件\n 通过 --set 参数传入的值\nchart 的 values.yaml 提供的值可以被用户提供的 values 文件覆盖，而该文件同样可以\n被 --set 提供的参数所覆盖。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm upgrade web --set replicas=5 nginx/")]),s._v("\nRelease "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web"')]),s._v(" has been upgraded. Happy Helming"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nNAME: web\nLAST DEPLOYED: Fri May "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2916")]),s._v(":34:172020\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nTEST SUITE: None\nNOTES:\nhello\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm history web")]),s._v("\nREVISION UPDATED STATUS CHART APP\nVERSION DESCRIPTION\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Fri May "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2916")]),s._v(":33:562020 superseded nginx-0.1.01.15\nInstall complete\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" Fri May "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2916")]),s._v(":34:172020 deployed nginx-0.1.01.15\nUpgrade complete\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod")]),s._v("\nNAME READY STATUS RESTARTS AGE\nweb-5675686b8-7n7bg "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 54s\nweb-5675686b8-9vf28 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 33s\nweb-5675686b8-9wkgz "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 54s\nweb-5675686b8-jdrhr "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 54s\nweb-5675686b8-rrrxc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 33s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h3",{attrs:{id:"升级、回滚和删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级、回滚和删除"}},[s._v("#")]),s._v(" 升级、回滚和删除")]),s._v(" "),t("ul",[t("li",[s._v("发布新版本的 chart 时，或者当您要更改发布的配置时，可以使用该 helm upgrade 命令。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm upgrade --set imageTag=1.17 web nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm upgrade -f values.yaml web nginx")]),s._v("\n如果在发布后没有达到预期的效果，则可以使用 helm rollback 回滚到之前的版本。\n例如将应用回滚到第一个版本：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm rollback web 1")]),s._v("\n卸载发行版，请使用以下 helm uninstall 命令：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm uninstall web")]),s._v("\n查看历史版本配置信息\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm get all --revision 1 web")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"管道与函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管道与函数"}},[s._v("#")]),s._v(" 管道与函数")]),s._v(" "),t("p",[s._v("前面讲的模块，其实就是将值传给模板引擎进行渲染，模板引擎还支持对拿到数据进行二\n次处理。\n例如从.Values 中读取的值变成字符串，可以使用 quote 函数实现：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi templates/deployment.yaml")]),s._v("\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" quote .Values.label.app "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install --dry-run web ../mychart/")]),s._v("\nproject: ms\napp: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("\nquote .Values.label.app 将后面的值作为参数传递给 quote 函数。\n模板函数调用语法为：functionName arg1 arg2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("另外还会经常使用一个 default 函数，该函数允许在模板中指定默认值，以防止该值被忽\n略掉。\n例如忘记定义，执行 helm install 会因为缺少字段无法创建资源，这时就可以定义一个\n默认值。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catvalues.yaml")]),s._v("\nreplicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat templates/deployment.yaml")]),s._v("\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-deployment\n- name: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" default "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n其他函数：\n缩进："),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.resources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" indent "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n大写："),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" upper .Values.resources "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n首字母大写："),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" title .Values.resources "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"流程控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#流程控制"}},[s._v("#")]),s._v(" 流程控制")]),s._v(" "),t("p",[s._v("流程控制是为模板提供了一种能力，满足更复杂的数据逻辑处理。\nHelm 模板语言提供以下流程控制语句：\n if/else 条件块\n with 指定范围\n range 循环块")]),s._v(" "),t("h3",{attrs:{id:"if"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#if"}},[s._v("#")]),s._v(" if")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("if/else 块是用于在模板中有条件地包含文本块的方法，条件块的基本结构如下：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" PIPELINE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Do something")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" elseif OTHER PIPELINE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Do something else")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default case")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n示例\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catvalues.yaml")]),s._v("\ndevops: k8\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat templates/deployment.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ntemplate:\nmetadata:\nlabels:\napp: nginx\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" eq .Values.devops "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ndevops: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ndevops: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n在上面条件语句使用了 eq 运算符判断是否相等，除此之外，还支持\nne、 lt、 gt、 and、 or 等运算符。\n注意数据类型。\n通过模板引擎来渲染一下，会得到如下结果：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install --dry-run web ../mychart/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlabels:\napp: nginx\ndevops: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n可以看到渲染出来会有多余的空行，这是因为当模板引擎运行时，会将控制指令删除，所\n有之前占的位置也就空白了，需要使用"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 的方式消除此空行：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat templates/deploymemt.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nenv:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- ifeq .Values.env.hello "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"world"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n- name: hello\nvalue: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n现在是不是没有多余的空格了，如果使用-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("需谨慎，比如上面模板文件中：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat templates/deploymemt.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nenv:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- ifeq .Values.env.hello "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"world"')]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n- hello: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n这会渲染成：\nenv:- hello: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n因为-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("它删除了双方的换行符。\n条件判断就是判断条件是否为真，如果值为以下几种情况则为 false：\n 一个布尔类型的 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n 一个数字 零\n 一个 空的字符串\n 一个空的集合（ map、 slice、 tuple、 dict、 array）\n除了上面的这些情况外，其他所有条件都为 真。\n例如，判断一个空的数组\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catvalues.yaml")]),s._v("\nresources: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# limits:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cpu: 100m")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# memory: 128Mi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# requests:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cpu: 100m")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# memory: 128Mi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat templates/deploymemt.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nspec:\ncontainers:\n- image: nginx:1.16\nname: nginx\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" .Values.resources "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nresources:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" toYaml .Values.resources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" indent "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n例如，判断一个布尔值\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catvalues.yaml")]),s._v("\nservice:\ntype: ClusterIP\nport: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\ningress:\nenabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nhost: example.ctnrs.com\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat templates/ingress.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" .Values.ingress.enabled -"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\napiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-ingress\nspec:\nrules:\n- host: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.ingress.host "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nhttp:\npaths:\n- path: /\nbackend:\nserviceName: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nservicePort: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.service.port "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br")])]),t("h3",{attrs:{id:"range"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#range"}},[s._v("#")]),s._v(" range")]),s._v(" "),t("p",[s._v("在 Helm 模板语言中，使用 range 关键字来进行循环操作。\n我们在 values.yaml 文件中添加上一个变量列表：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catvalues.yaml")]),s._v("\ntest:\n- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n循环打印该列表：\napiVersion: v1\nkind: ConfigMap\nmetadata:\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ndata:\ntest: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- range .Values.test "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n循环内部我们使用的是一个 .，这是因为当前的作用域就在当前循环内，这个 .引用的\n当前读取的元素。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h3",{attrs:{id:"with"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#with"}},[s._v("#")]),s._v(" with")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("with ：控制变量作用域。\n还记得之前我们的 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".Release.xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("或者 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".Values.xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("吗？其中的 .就是表示对\n当前范围的引用， .Values 就是告诉模板在当前范围中查找 Values 对象的值。\n而 with 语句就可以来控制变量的作用域范围，其语法和一个简单的 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 语句比较类似：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" with PIPELINE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# restricted scope")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nwith 语句可以允许将当前范围 .设置为特定的对象，比如我们前面一直使用\n的 .Values.label，我们可以使用 with 来将 .范围指向 .Values.label：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catvalues.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nnodeSelector:\nteam: a\ngpu: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat templates/deployment.yaml")]),s._v("\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-deployment\nspec:\nreplicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nselector:\nmatchLabels:\napp: nginx\ntemplate:\nmetadata:\nlabels:\napp: nginx\nspec:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- with .Values.nodeSelector "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nnodeSelector:\nteam: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .team "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ngpu: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .gpu "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ncontainers:\n- image: nginx:1.16\nname: nginx\n优化后：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- with .Values.nodeSelector "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nnodeSelector:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- toYaml "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" nindent "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n上面增加了一个"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- with .Values.nodeSelector"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" xxx "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("的一个块，这样的话\n就可以在当前的块里面直接引用 .team 和 .gpu 了。\nwith 是一个循环构造。使用.Values.nodeSelector 中的值：将其转换为 Yaml。\ntoYaml 之后的点是循环中.Values.nodeSelector 的当前值\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("h3",{attrs:{id:"变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#变量"}},[s._v("#")]),s._v(" 变量")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("变量，在模板中，使用变量的场合不多，但我们将看到如何使用它来简化代码，并更好地\n利用 with 和 range。\n问题 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：获取数组键值\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ../values.yaml")]),s._v("\nenv:\nNAME: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gateway"')]),s._v("\nJAVA_OPTS: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xmx1G"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catdeployment.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nenv:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- range "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$k")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$v")]),s._v(" :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" .Values.env "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n- name: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$k")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvalue: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$v")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" quote "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n结果如下\nenv:\n- name: JAVA_OPTS\nvalue: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xmx1G"')]),s._v("\n- name: NAME\nvalue: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gateway"')]),s._v(" 上面在 range 循环中使用 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$key")]),s._v(" 和 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$value")]),s._v(" 两个变量来接收后面列表循环的键和值。\n问题 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：with 中不能使用内置对象\nwith 语句块内不能再 .Release.Name 对象，否则报错。\n我们可以将该对象赋值给一个变量可以来解决这个问题：\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-deployment\nspec:\nreplicas: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.replicas "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ntemplate:\nmetadata:\nlabels:\nproject: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.label.project "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" quote .Values.label.app "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- with .Values.label "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nproject: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .project "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .app "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nrelease: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n上面会出错\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releaseName")]),s._v(" :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" .Release.Name -"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- with .Values.label "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nproject: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .project "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .app "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nrelease: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releaseName")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者可以使用$符号,引入全局命名空间")]),s._v("\nrelease: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" $.Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n可以看到在 with 语句上面增加了一句 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releaseName")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".Release.Name-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("，其\n中 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releaseName")]),s._v(" 就是后面的对象的一个引用变量，它的形式就是 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v("，赋值操作使\n用 :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("，这样 with 语句块内部的 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$releaseName")]),s._v(" 变量仍然指向的是 .Release.Name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br")])]),t("h3",{attrs:{id:"命名模板"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命名模板"}},[s._v("#")]),s._v(" 命名模板")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("需要复用代码的地方用。\n命名模板：使用 define 定义，template 引入，在 templates 目录中默认下划线开头的文\n件为公共模板"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("helpers.tpl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat _helpers.tpl")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- define "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo.fullname"')]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- .Chart.Name -"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Release.Name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end -"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catdeployment.yaml")]),s._v("\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" template"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo.fullname"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ntemplate 指令是将一个模板包含在另一个模板中的方法。但是，template 函数不能用于\nGo 模板管道。为了解决该问题，增加 include 功能。\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat _helpers.tpl")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- define "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo.labels"')]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\napp: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" template"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo.fullname"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nchart: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ .Chart.Name }}-{{ .Chart.Version }}"')]),s._v("\nrelease: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ .Release.Name }}"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- end -"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# catdeployment.yaml")]),s._v("\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" include"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo.fullname"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nlabels:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("- include "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo.labels"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" nindent "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". 上面包含一个名为 demo.labels 的模板，然后将值 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" 传递给模板，最后将该模板的\n输出传递给 nindent 函数。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("h2",{attrs:{id:"开发自己的-chart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发自己的-chart"}},[s._v("#")]),s._v(" 开发自己的 chart")]),s._v(" "),t("p",[s._v("1、先创建模板\n2、修改 Chart.yaml，Values.yaml，添加常用的变量\n3、 在 templates 目录下创建部署镜像所需要的 yaml 文件，并变量引用 yaml 里经常变动\n的字段")])])}),[],!1,null,null,null);a.default=e.exports}}]);