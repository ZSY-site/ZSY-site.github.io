(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{1425:function(t,s,a){t.exports=a.p+"assets/img/5.e79f52f2.jpg"},1426:function(t,s,a){t.exports=a.p+"assets/img/6.14a1408c.png"},1427:function(t,s,a){t.exports=a.p+"assets/img/7.4e303ee7.png"},1428:function(t,s,a){t.exports=a.p+"assets/img/8.1c377d47.png"},1429:function(t,s,a){t.exports=a.p+"assets/img/9.aafe05a7.jpg"},1430:function(t,s,a){t.exports=a.p+"assets/img/10.f9ca14a7.jpg"},3242:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"前话"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前话"}},[t._v("#")]),t._v(" 前话")]),t._v(" "),n("ul",[n("li",[t._v("WebSocket 客户端与服务端通信的最小单位是帧，由 1 个或多个帧组成一条完整的消息（message）")]),t._v(" "),n("li",[t._v("发送端 将消息切割成多个帧，并发送给服务端")]),t._v(" "),n("li",[t._v("接收端 接收消息帧，并将关联的帧重新组装成完整的消息")])]),t._v(" "),n("h2",{attrs:{id:"bit-和-byte"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bit-和-byte"}},[t._v("#")]),t._v(" bit 和 byte")]),t._v(" "),n("ul",[n("li",[t._v("比特就是 bit 二进制数系统中,每个 0 或 1 就是一个位(bit), 位是数据存储的最小单位")]),t._v(" "),n("li",[t._v("其中 8 个 bit 就称为一个字节(Byte)")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(1425),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"位运算符"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#位运算符"}},[t._v("#")]),t._v(" 位运算符")]),t._v(" "),n("h3",{attrs:{id:"按位与"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#按位与"}},[t._v("#")]),t._v(" 按位与(&)")]),t._v(" "),n("ul",[n("li",[t._v("两个输入数的同一位都为 1 才为 1")]),t._v(" "),n("li",[n("img",{attrs:{src:a(1426),alt:""}})])]),t._v(" "),n("h3",{attrs:{id:"按位或"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#按位或"}},[t._v("#")]),t._v(" 按位或(|)")]),t._v(" "),n("ul",[n("li",[t._v("两个输入数的同一位只要有一个为 1 就是 1")]),t._v(" "),n("li",[n("img",{attrs:{src:a(1427),alt:""}})])]),t._v(" "),n("h3",{attrs:{id:"按位异或"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#按位异或"}},[t._v("#")]),t._v(" 按位异或(^)")]),t._v(" "),n("ul",[n("li",[t._v("两个输入数的同一位不同就是 1,如果相同就设为 0")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(1428),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"数据帧格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据帧格式"}},[t._v("#")]),t._v(" 数据帧格式")]),t._v(" "),n("ul",[n("li",[t._v("单位是比特 比如 FIN、RSV1 各占据 1 比特,opcode 占据 4 比特")])]),t._v(" "),n("blockquote",[n("p",[t._v("下图是每帧大致的格式\n"),n("img",{attrs:{src:a(1429),alt:""}})])]),t._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("                   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("                   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("                   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n +-+-+-+-+-------+-+-------------+-------------------------------+\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("F"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("R"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("R"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("R"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" opcode"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("M"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Payload len "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("    Extended payload length    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("I"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("S"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("S"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("S"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("A"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("             "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("N"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("V"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("V"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("V"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("S"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("             "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("if payload "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("len")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("126")]),t._v("/127"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("K"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("             "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("                               "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     Extended payload length continued, "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" payload len "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n + - - - - - - - - - - - - - - - +-------------------------------+\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("                               "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("Masking-key, "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" MASK "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" to "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n +-------------------------------+-------------------------------+\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Masking-key "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("continued"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("          Payload Data         "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n +-------------------------------- - - - - - - - - - - - - - - - +\n "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("                     Payload Data continued "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\n + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("                     Payload Data continued "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".                "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n +---------------------------------------------------------------+\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br")])]),n("table",[n("thead",[n("tr",[n("th",[t._v("字段")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("FIN")]),t._v(" "),n("td",[t._v("1 个比特 如果是 1,表示这是消息（message）的最后一个分片（fragment）,如果是 0,表示不是消息(message)的最后一个分片(fragment)")])]),t._v(" "),n("tr",[n("td",[t._v("RSV1, RSV2, RSV3")]),t._v(" "),n("td",[t._v("各占 1 个比特。一般情况下全为 0")])]),t._v(" "),n("tr",[n("td",[t._v("Opcode")]),t._v(" "),n("td",[t._v("占 4 个比特,操作代码")])]),t._v(" "),n("tr",[n("td",[t._v("Mask")]),t._v(" "),n("td",[t._v("1 个比特。表示是否要对数据载荷进行掩码（可理解为加密）操作,从客户端向服务端发送数据时，需要对数据进行掩码操作；从服务端向客户端发送数据时，不需要对数据进行掩码操作,如果 Mask 是 1，那么在 Masking-key 中会定义一个掩码键(masking key),并用这个掩码键来对数据载荷进行反掩码。所有客户端发送到服务端的数据帧，Mask 都是 1")])]),t._v(" "),n("tr",[n("td",[t._v("Payload length")]),t._v(" "),n("td",[t._v("数据载荷的长度")])]),t._v(" "),n("tr",[n("td",[t._v("Masking-key")]),t._v(" "),n("td",[t._v("0 或 4 字节(32 位) 所有从客户端传送到服务端的数据帧,数据载荷都进行了掩码操作,Mask 为 1,且携带了 4 字节的 Masking-key。如果 Mask 为 0,则没有 Masking-key。载荷数据的长度，不包括 mask key 的长度")])]),t._v(" "),n("tr",[n("td",[t._v("Payload data")]),t._v(" "),n("td",[t._v("载荷数据")])])])]),t._v(" "),n("ul",[n("li",[t._v("Opcode")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("字段")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("%x0")]),t._v(" "),n("td",[t._v("表示一个延续帧。当 Opcode 为 0 时，表示本次数据传输采用了数据分片，当前收到的数据帧为其中一个数据分片")])]),t._v(" "),n("tr",[n("td",[t._v("%x1")]),t._v(" "),n("td",[t._v("表示这是一个文本帧 （可能是一个字符串）")])]),t._v(" "),n("tr",[n("td",[t._v("%x2")]),t._v(" "),n("td",[t._v("表示这是一个二进制帧（可能是视频或者音频）")])]),t._v(" "),n("tr",[n("td",[t._v("%x3-7")]),t._v(" "),n("td",[t._v("保留的操作代码, 即没用到")])]),t._v(" "),n("tr",[n("td",[t._v("%x8")]),t._v(" "),n("td",[t._v("表示连接断开")])]),t._v(" "),n("tr",[n("td",[t._v("%x9")]),t._v(" "),n("td",[t._v("表示这是一个 ping 操作")])]),t._v(" "),n("tr",[n("td",[t._v("%xA")]),t._v(" "),n("td",[t._v("表示这是一个 pong 操作")])]),t._v(" "),n("tr",[n("td",[t._v("%xB-F")]),t._v(" "),n("td",[t._v("保留的操作代码")])])])]),t._v(" "),n("h2",{attrs:{id:"payload-length"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#payload-length"}},[t._v("#")]),t._v(" Payload length")]),t._v(" "),n("ul",[n("li",[t._v("Payload length：数据载荷的长度，单位是字节。为 7 位，或 7+16 位，或 7+64 位\n"),n("ul",[n("li",[t._v("Payload length=x 为 0~125：数据的长度为 x 字节。")]),t._v(" "),n("li",[t._v("Payload length=x 为 126：后续 2 个字节代表一个 16 位的无符号整数，该无符号整数的值为数据的长度")]),t._v(" "),n("li",[t._v("Payload length=x 为 127：后续 8 个字节代表一个 64 位的无符号整数（最高位为 0），该无符号整数的值为数据的长度。")]),t._v(" "),n("li",[t._v("如果 payload length 占用了多个字节的话，payload length 的二进制表达采用网络序（big endian，重要的位在前)")])])]),t._v(" "),n("li",[t._v("readBigUInt64BE 用指定的字节序[readBigInt64BE() 读取为大端序,readBigInt64LE() 读取为小端序]从 buf 中指定的 offset 读取一个有符号的 64 位整数值")]),t._v(" "),n("li",[t._v("Big-endian(大端序) 高位字节在前")]),t._v(" "),n("li",[t._v("Little-endian(小端序) 低位字节在前")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buffer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Math"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readUInt16BE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 00000001 00000000")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readUInt16LE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 00000000 00000001")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("buffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" byte "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readUInt8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseInt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("byte"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("substring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("126")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readUInt16BE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readBigUInt64BE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("126")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b10000001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b10000001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b10000001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b11111110")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b10000001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b11111111")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b00000001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br")])]),n("h2",{attrs:{id:"掩码算法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#掩码算法"}},[t._v("#")]),t._v(" 掩码算法")]),t._v(" "),n("ul",[n("li",[t._v("掩码键（Masking-key）是由客户端挑选出来的 32bit 的随机数,掩码操作不会影响数据载荷的长度")]),t._v(" "),n("li",[t._v("掩码和反掩码操作都采用如下算法")]),t._v(" "),n("li",[t._v("对索引 i 模以 4 得到结果并对原来的索引进行异或操作")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(1430),alt:""}})])])}),[],!1,null,null,null);s.default=e.exports}}]);