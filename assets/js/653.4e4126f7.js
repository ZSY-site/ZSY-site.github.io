(window.webpackJsonp=window.webpackJsonp||[]).push([[653],{2402:function(e,v,_){"use strict";_.r(v);var o=_(2),t=Object(o.a)({},(function(){var e=this,v=e.$createElement,_=e._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("p",[_("a",{attrs:{href:"https://github.com/BetaSu/big-react/commit/520d963d19fbf3f9bada58d13a788e8f3e49667a",target:"_blank",rel:"noopener noreferrer"}},[e._v("本节课代码地址"),_("OutboundLink")],1)]),e._v(" "),_("p",[e._v("更新流程的目的：")]),e._v(" "),_("ul",[_("li",[e._v("生成"),_("code",[e._v("wip fiberNode")]),e._v("树")]),e._v(" "),_("li",[e._v("标记副作用"),_("code",[e._v("flags")])])]),e._v(" "),_("p",[e._v("更新流程的步骤：")]),e._v(" "),_("ul",[_("li",[e._v("递："),_("code",[e._v("beginWork")])]),e._v(" "),_("li",[e._v("归："),_("code",[e._v("completeWork")])])]),e._v(" "),_("h2",{attrs:{id:"beginwork"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#beginwork"}},[e._v("#")]),e._v(" beginWork")]),e._v(" "),_("p",[e._v("对于如下结构的"),_("code",[e._v("reactElement")]),e._v("：")]),e._v(" "),_("p",[_("code",[e._v("<A> <B/> </A>")])]),e._v(" "),_("p",[e._v("当进入 A 的"),_("code",[e._v("beginWork")]),e._v("时，通过对比 B "),_("code",[e._v("current fiberNode")]),e._v("与 B "),_("code",[e._v("reactElement")]),e._v("，生成 B 对应"),_("code",[e._v("wip fiberNode")]),e._v("。")]),e._v(" "),_("p",[e._v("在此过程中最多会标记 2 类与**「结构变化」**相关的"),_("code",[e._v("flags")]),e._v("：")]),e._v(" "),_("ul",[_("li",[e._v("Placement")])]),e._v(" "),_("p",[_("code",[e._v("插入： a -> ab 移动： abc -> bca")])]),e._v(" "),_("ul",[_("li",[e._v("ChildDeletion")])]),e._v(" "),_("p",[_("code",[e._v("删除： ul>li*3 -> ul>li*1")])]),e._v(" "),_("p",[e._v("不包含与**「属性变化」**相关的 flag：Update")]),e._v(" "),_("p",[_("code",[e._v('<img title="鸡" /> -> <img title="你太美" />')])]),e._v(" "),_("h2",{attrs:{id:"实现与-host-相关节点的-beginwork"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#实现与-host-相关节点的-beginwork"}},[e._v("#")]),e._v(" 实现与 Host 相关节点的 beginWork")]),e._v(" "),_("p",[e._v("首先，为开发环境增加"),_("code",[e._v("__DEV__")]),e._v("标识，方便 Dev 包打印更多信息：")]),e._v(" "),_("p",[_("code",[e._v("pnpm i -d -w @rollup/plugin-replace")])]),e._v(" "),_("h3",{attrs:{id:"hostroot的beginwork工作流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#hostroot的beginwork工作流程"}},[e._v("#")]),e._v(" "),_("code",[e._v("HostRoot")]),e._v("的"),_("code",[e._v("beginWork")]),e._v("工作流程")]),e._v(" "),_("ol",[_("li",[e._v("计算状态的最新值")]),e._v(" "),_("li",[e._v("创造子"),_("code",[e._v("fiberNode")])])]),e._v(" "),_("h3",{attrs:{id:"hostcomponent的beginwork工作流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#hostcomponent的beginwork工作流程"}},[e._v("#")]),e._v(" "),_("code",[e._v("HostComponent")]),e._v("的"),_("code",[e._v("beginWork")]),e._v("工作流程")]),e._v(" "),_("ol",[_("li",[e._v("创造子"),_("code",[e._v("fiberNode")])])]),e._v(" "),_("h3",{attrs:{id:"hosttext没有beginwork工作流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#hosttext没有beginwork工作流程"}},[e._v("#")]),e._v(" "),_("code",[e._v("HostText")]),e._v("没有"),_("code",[e._v("beginWork")]),e._v("工作流程")]),e._v(" "),_("p",[e._v("因为他没有子节点")]),e._v(" "),_("p",[_("code",[e._v("<p>唱跳Rap</p>")])]),e._v(" "),_("h2",{attrs:{id:"beginwork-性能优化策略"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#beginwork-性能优化策略"}},[e._v("#")]),e._v(" beginWork 性能优化策略")]),e._v(" "),_("p",[e._v("考虑如下结构的"),_("code",[e._v("reactElement")]),e._v("：")]),e._v(" "),_("p",[_("code",[e._v("<div> <p>练习时长</p> <span>两年半</span> </div>")])]),e._v(" "),_("p",[e._v("理论上"),_("code",[e._v("mount")]),e._v("流程完毕后包含的"),_("code",[e._v("flags")]),e._v("：")]),e._v(" "),_("ul",[_("li",[e._v("两年半 Placement")]),e._v(" "),_("li",[e._v("span Placement")]),e._v(" "),_("li",[e._v("练习时长 Placement")]),e._v(" "),_("li",[e._v("p Placement")]),e._v(" "),_("li",[e._v("div Placement")])]),e._v(" "),_("p",[e._v("相比于执行 5 次"),_("code",[e._v("Placment")]),e._v("，我们可以构建好**「离屏 DOM 树」**后，对"),_("code",[e._v("div")]),e._v("执行 1 次"),_("code",[e._v("Placement")]),e._v("操作")]),e._v(" "),_("h2",{attrs:{id:"completework"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#completework"}},[e._v("#")]),e._v(" completeWork")]),e._v(" "),_("p",[e._v("需要解决的问题：")]),e._v(" "),_("ul",[_("li",[e._v("对于"),_("code",[e._v("Host")]),e._v("类型"),_("code",[e._v("fiberNode")]),e._v("：构建离屏 DOM 树")]),e._v(" "),_("li",[e._v("标记 Update flag（TODO）")])]),e._v(" "),_("h2",{attrs:{id:"completework-性能优化策略"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#completework-性能优化策略"}},[e._v("#")]),e._v(" completeWork 性能优化策略")]),e._v(" "),_("p",[_("code",[e._v("flags")]),e._v("分布在不同"),_("code",[e._v("fiberNode")]),e._v("中，如何快速找到他们？")]),e._v(" "),_("p",[e._v("答案：利用"),_("code",[e._v("completeWork")]),e._v("向上遍历（归）的流程，将子"),_("code",[e._v("fiberNode")]),e._v("的"),_("code",[e._v("flags")]),e._v("冒泡到父"),_("code",[e._v("fiberNode")])])])}),[],!1,null,null,null);v.default=t.exports}}]);