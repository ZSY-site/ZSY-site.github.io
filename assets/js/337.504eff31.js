(window.webpackJsonp=window.webpackJsonp||[]).push([[337],{1127:function(s,a,e){s.exports=e.p+"assets/img/3.97e8b8d4.png"},2715:function(s,a,e){"use strict";e.r(a);var t=e(2),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"前置知识点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前置知识点"}},[s._v("#")]),s._v(" 前置知识点")]),s._v(" "),t("p",[s._v("目前生产部署 Kubernetes 集群主要有两种方式：\n（1）kubeadm\nKubeadm 是一个 K8s 部署工具，提供 kubeadm init 和 kubeadm join，用于快速部\n署 Kubernetes 集群。\n官方地址：https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/\n（2）二进制包\n从 github 下载发行版的二进制包，手动部署每个组件，组成 Kubernetes 集群。\nKubeadm 降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。如果想更容易可\n控，推荐使用二进制包部署 Kubernetes 集群，虽然手动部署麻烦点，期间可以学习很\n多工作原理，也利于后期维护。")]),s._v(" "),t("h2",{attrs:{id:"kubeadm-部署方式介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm-部署方式介绍"}},[s._v("#")]),s._v(" kubeadm 部署方式介绍")]),s._v(" "),t("p",[s._v("kubeadm 是官方社区推出的一个用于快速部署 kubernetes 集群的工具，这个工具能通\n过两条指令完成一个 kubernetes 集群的部署：\n第一、创建一个 Master 节点 kubeadm init\n第二， 将 Node 节点加入到当前集群中 $ kubeadm join "),t("code",[s._v("<Master 节点的 IP 和端口 >")])]),s._v(" "),t("h2",{attrs:{id:"安装要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装要求"}},[s._v("#")]),s._v(" 安装要求")]),s._v(" "),t("p",[s._v("在开始之前，部署 Kubernetes 集群机器需要满足以下几个条件：")]),s._v(" "),t("ul",[t("li",[s._v("一台或多台机器，操作系统 CentOS7.x-86_x64")]),s._v(" "),t("li",[s._v("硬件配置：2GB 或更多 RAM，2 个 CPU 或更多 CPU，硬盘 30GB 或更多")]),s._v(" "),t("li",[s._v("集群中所有机器之间网络互通")]),s._v(" "),t("li",[s._v("可以访问外网，需要拉取镜像")]),s._v(" "),t("li",[s._v("禁止 swap 分区")])]),s._v(" "),t("h2",{attrs:{id:"最终目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最终目标"}},[s._v("#")]),s._v(" 最终目标")]),s._v(" "),t("p",[s._v("（1） 在所有节点上安装 Docker 和 kubeadm\n（2）部署 Kubernetes Master\n（3）部署容器网络插件\n（4）部署 Kubernetes Node，将节点加入 Kubernetes 集群中\n（5）部署 Dashboard Web 页面，可视化查看 Kubernetes 资源")]),s._v(" "),t("h2",{attrs:{id:"准备环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备环境"}},[s._v("#")]),s._v(" 准备环境")]),s._v(" "),t("p",[t("img",{attrs:{src:e(1127),alt:""}})]),s._v(" "),t("p",[s._v("角色 IP\nk8s-master 192.168.31.61\nk8s-node1 192.168.31.62\nk8s-node2 192.168.31.63")]),s._v(" "),t("h2",{attrs:{id:"系统初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统初始化"}},[s._v("#")]),s._v(" 系统初始化")]),s._v(" "),t("h3",{attrs:{id:"关闭防火墙"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙"}},[s._v("#")]),s._v(" 关闭防火墙")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ systemctl stop firewalld\n$ systemctl disable firewalld\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"关闭-selinux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭-selinux"}},[s._v("#")]),s._v(" 关闭 selinux")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/'")]),s._v(" /etc/selinux/config "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久")]),s._v("\n$ setenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"关闭-swap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭-swap"}},[s._v("#")]),s._v(" 关闭 swap")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ swapoff "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/fstab "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"主机名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机名"}},[s._v("#")]),s._v(" 主机名")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ hostnamectl set-hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"在-master-添加-hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-master-添加-hosts"}},[s._v("#")]),s._v(" 在 master 添加 hosts")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n192.168.31.61 k8s-master\n192.168.31.62 k8s-node1\n192.168.31.63 k8s-node2\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"将桥接的-ipv4-流量传递到-iptables-的链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将桥接的-ipv4-流量传递到-iptables-的链"}},[s._v("#")]),s._v(" 将桥接的 IPv4 流量传递到 iptables 的链")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysctl.d/k8s.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--system")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生效")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"时间同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#时间同步"}},[s._v("#")]),s._v(" 时间同步")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntpdate "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n$ ntpdate time.windows.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"所有节点安装-docker-kubeadm-kubelet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有节点安装-docker-kubeadm-kubelet"}},[s._v("#")]),s._v(" 所有节点安装 Docker/kubeadm/kubelet")]),s._v(" "),t("p",[s._v("Kubernetes 默认 CRI（容器运行时）为 Docker，因此先安装 Docker。")]),s._v(" "),t("h3",{attrs:{id:"_1-安装-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-docker"}},[s._v("#")]),s._v(" （1）安装 Docker")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v("\n/etc/yum.repos.d/docker-ce.repo\n$ yum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce-18.06.1.ce-3.el7\n$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-添加阿里云-yum-软件源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加阿里云-yum-软件源"}},[s._v("#")]),s._v(" （2）添加阿里云 YUM 软件源")]),s._v(" "),t("p",[s._v("设置仓库地址")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /etc/docker/daemon.json << EOF")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://b9pmyelo.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("添加 yum 源")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\nhttps://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_3-安装-kubeadm-kubelet-和-kubectl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装-kubeadm-kubelet-和-kubectl"}},[s._v("#")]),s._v(" （3）安装 kubeadm，kubelet 和 kubectl")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" kubelet kubeadm kubectl\n$ systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"部署-kubernetes-master"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署-kubernetes-master"}},[s._v("#")]),s._v(" 部署 Kubernetes Master")]),s._v(" "),t("h3",{attrs:{id:"_1-在-192-168-31-61-master-执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-在-192-168-31-61-master-执行"}},[s._v("#")]),s._v(" （1）在 192.168.31.61（Master）执行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubeadm init "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--apiserver-advertise-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".31.61 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--image-repository registry.aliyuncs.com/google_containers "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--kubernetes-version v1.17.0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--service-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.0/12 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--pod-network-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("由于默认拉取镜像地址 k8s.gcr.io 国内无法访问，这里指定阿里云镜像仓库地址。")]),s._v(" "),t("h3",{attrs:{id:"_2-使用-kubectl-工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-kubectl-工具"}},[s._v("#")]),s._v(" （2）使用 kubectl 工具：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /etc/kubernetes/admin.conf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n$ kubectl get nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"安装-pod-网络插件-cni"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-pod-网络插件-cni"}},[s._v("#")]),s._v(" 安装 Pod 网络插件（CNI）")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubectl apply –f\nhttps://raw.githubusercontent.com/coreos/flannel/master/Documentation/kubeflannel.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("确保能够访问到 quay.io 这个 registery。如果 Pod 镜像下载失败，可以改这个镜像地址")]),s._v(" "),t("h2",{attrs:{id:"加入-kubernetes-node"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加入-kubernetes-node"}},[s._v("#")]),s._v(" 加入 Kubernetes Node")]),s._v(" "),t("p",[s._v("（1）在 192.168.31.62/63（Node）执行\n向集群添加新节点，执行在 kubeadm init 输出的 kubeadm join 命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".31.61:6443 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" esce21.q6hetwm8si29qxwn "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--discovery-token-ca-cert-hash\nsha256:00603a05805807501d7181c3d60b478788408cfe6cedefedb1f97569708be9c5\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"测试-kubernetes-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-kubernetes-集群"}},[s._v("#")]),s._v(" 测试 kubernetes 集群")]),s._v(" "),t("p",[s._v("在 Kubernetes 集群中创建一个 pod，验证是否正常运行：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubectl create deployment nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n$ kubectl expose deployment nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n$ kubectl get pod,svc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("访问地址：http://NodeIP:Port")])])}),[],!1,null,null,null);a.default=n.exports}}]);