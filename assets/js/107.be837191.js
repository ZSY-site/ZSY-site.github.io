(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{1116:function(s,n,a){s.exports=a.p+"assets/img/40.726665f8.png"},1117:function(s,n,a){s.exports=a.p+"assets/img/41.b6018c69.png"},1118:function(s,n,a){s.exports=a.p+"assets/img/42.44492a3c.png"},1119:function(s,n,a){s.exports=a.p+"assets/img/43.fe4d84fb.png"},1120:function(s,n,a){s.exports=a.p+"assets/img/44.85c08aa8.png"},2711:function(s,n,a){"use strict";a.r(n);var e=a(2),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"基本概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),e("p",[s._v("管理存储是管理计算的一个明显问题。该 PersistentVolume 子系统为用户和管理员提供了\n一个 API，用于抽象如何根据消费方式提供存储的详细信息。为此，我们引入了两个新的\nAPI 资源：PersistentVolume 和 PersistentVolumeClaim\nPersistentVolume（PV）是集群中由管理员配置的一段网络存储。 它是集群中的资源，就\n像节点是集群资源一样。 PV 是容量插件，如 Volumes，但其生命周期独立于使用 PV 的任\n何单个 pod。 此 API 对象捕获存储实现的详细信息，包括 NFS，iSCSI 或特定于云提供程\n序的存储系统。")]),s._v(" "),e("p",[s._v("PersistentVolumeClaim（PVC）是由用户进行存储的请求。 它类似于 pod。 Pod 消耗节点\n资源，PVC 消耗 PV 资源。Pod 可以请求特定级别的资源（CPU 和内存）。声明可以请求特\n定的大小和访问模式（例如，可以一次读/写或多次只读）。")]),s._v(" "),e("p",[s._v("虽然 PersistentVolumeClaims 允许用户使用抽象存储资源，但是 PersistentVolumes 对于\n不同的问题，用户通常需要具有不同属性（例如性能）。群集管理员需要能够提供各种\nPersistentVolumes 不同的方式，而不仅仅是大小和访问模式，而不会让用户了解这些卷\n的实现方式。对于这些需求，有 StorageClass 资源。")]),s._v(" "),e("p",[s._v("StorageClass 为管理员提供了一种描述他们提供的存储的“类”的方法。 不同的类可能\n映射到服务质量级别，或备份策略，或者由群集管理员确定的任意策略。 Kubernetes 本\n身对于什么类别代表是不言而喻的。 这个概念有时在其他存储系统中称为“配置文件”。")]),s._v(" "),e("p",[s._v("PVC 和 PV 是一一对应的。")]),s._v(" "),e("h2",{attrs:{id:"生命周期"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生命周期"}},[s._v("#")]),s._v(" 生命周期")]),s._v(" "),e("p",[s._v("PV 是群集中的资源。PVC 是对这些资源的请求，并且还充当对资源的检查。PV 和 PVC 之间\n的相互作用遵循以下生命周期：\nProvisioning ——-> Binding ——–>Using——>Releasing——>Recycling")]),s._v(" "),e("p",[s._v("供应准备 Provisioning---通过集群外的存储系统或者云平台来提供存储持久化支持。")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("静态提供 Static：集群管理员创建多个 PV。 它们携带可供集群用户使用的真实存储的\n详细信息。 它们存在于 Kubernetes API 中，可用于消费")])]),s._v(" "),e("li",[e("p",[s._v("动态提供 Dynamic：当管理员创建的静态 PV 都不匹配用户的 PersistentVolumeClaim\n时，集群可能会尝试为 PVC 动态配置卷。 此配置基于 StorageClasses：PVC 必须请求一个\n类，并且管理员必须已创建并配置该类才能进行动态配置。 要求该类的声明有效地为自己\n禁用动态配置。")])])]),s._v(" "),e("p",[s._v("绑定 Binding---用户创建 pvc 并指定需要的资源和访问模式。在找到可用 pv 之前，pvc\n会保持未绑定状态。")]),s._v(" "),e("p",[s._v("使用 Using---用户可在 pod 中像 volume 一样使用 pvc。")]),s._v(" "),e("p",[s._v("释放 Releasing---用户删除 pvc 来回收存储资源，pv 将变成“released”状态。由于还\n保留着之前的数据，这些数据需要根据不同的策略来处理，否则这些存储资源无法被其他\npvc 使用。")]),s._v(" "),e("p",[s._v("回收 Recycling---pv 可以设置三种回收策略：保留（Retain），回收（Recycle）和删除\n（Delete）。")]),s._v(" "),e("ul",[e("li",[s._v("保留策略：允许人工处理保留的数据。")]),s._v(" "),e("li",[s._v("删除策略：将删除 pv 和外部关联的存储资源，需要插件支持。")]),s._v(" "),e("li",[s._v("回收策略：将执行清除操作，之后可以被新的 pvc 使用，需要插件支持")])]),s._v(" "),e("h2",{attrs:{id:"pv-类型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pv-类型"}},[s._v("#")]),s._v(" PV 类型")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("GCEPersistentDisk\nAWSElasticBlockStore\nAzureFile\nAzureDisk\nFC "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Fibre Channel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nFlexvolume\nFlocker\nNFS\niSCSI\nRBD "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ceph Block Device"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCephFS\nCinder "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OpenStack block storage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nGlusterfs\nVsphereVolume\nQuobyte Volumes\nHostPath "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Single "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" testing only – "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" storage is not supported "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" any\nway and WILL NOT WORK "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a multi-node cluster"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nPortworx Volumes\nScaleIO Volumes\nStorageOS\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("h2",{attrs:{id:"pv-卷阶段状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pv-卷阶段状态"}},[s._v("#")]),s._v(" PV 卷阶段状态")]),s._v(" "),e("p",[s._v("Available – 资源尚未被 claim 使用\nBound – 卷已经被绑定到 claim 了\nReleased – claim 被删除，卷处于释放状态，但未被集群回收。\nFailed – 卷自动回收失败")]),s._v(" "),e("h2",{attrs:{id:"演示-创建-pv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#演示-创建-pv"}},[s._v("#")]),s._v(" 演示：创建 PV")]),s._v(" "),e("p",[s._v("（1）第一步：编写 yaml 文件，并创建 pv\n创建 5 个 pv，存储大小各不相同，是否可读也不相同")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("apiVersion: v1\nkind: PersistentVolume\nmetadata:\nname: pv001\nlabels:\nname: pv001\nspec:\nnfs:\npath: /data/volumes/v1\nserver: nfs\naccessModes: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteMany"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteOnce"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncapacity:\nstorage: 2Gi\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\nname: pv002\nlabels:\nname: pv002\nspec:\nnfs:\npath: /data/volumes/v2\nserver: nfs\naccessModes: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteOnce"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncapacity:\nstorage: 5Gi\n---\napiVersion: v1\n\nkind: PersistentVolume\nmetadata:\nname: pv003\nlabels:\nname: pv003\nspec:\nnfs:\npath: /data/volumes/v3\nserver: nfs\naccessModes: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteMany"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteOnce"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncapacity:\nstorage: 20Gi\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\nname: pv004\nlabels:\nname: pv004\nspec:\nnfs:\npath: /data/volumes/v4\nserver: nfs\naccessModes: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteMany"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteOnce"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncapacity:\nstorage: 10Gi\n---\napiVersion: v1\nkind: PersistentVolume\n\nmetadata:\nname: pv005\nlabels:\nname: pv005\nspec:\nnfs:\npath: /data/volumes/v5\nserver: nfs\naccessModes: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteMany"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteOnce"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncapacity:\nstorage: 15Gi\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br")])]),e("p",[s._v("（2）第二步：执行创建命令\nkubectl apply -f pv-damo.yaml\n"),e("img",{attrs:{src:a(1116),alt:""}})]),s._v(" "),e("p",[s._v("（3）第三步：查询验证\n"),e("img",{attrs:{src:a(1117),alt:""}})]),s._v(" "),e("h2",{attrs:{id:"演示-创建-pvc-绑定-pv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#演示-创建-pvc-绑定-pv"}},[s._v("#")]),s._v(" 演示：创建 PVC，绑定 PV")]),s._v(" "),e("p",[s._v("（1）第一步：编写 yaml 文件，并创建 pvc\n创建一个 pvc，需要 6G 存储；所以不会匹配 pv001、pv002、pv003")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\nname: mypvc\nnamespace: default\nspec:\naccessModes: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteMany"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nresources:\nrequests:\nstorage: 6Gi\n---\napiVersion: v1\nkind: Pod\nmetadata:\nname: vol-pvc\nnamespace: default\nspec:\nvolumes:\n- name: html\npersistentVolumeClaim:\nclaimName: mypvc\ncontainers:\n- name: myapp\nimage: ikubernetes/myapp:v1\nvolumeMounts:\n- name: html\nmountPath: /usr/share/nginx/html/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("p",[s._v("（2）第二步：执行命令创建\nkubectl apply -f vol-pvc-demo.yaml\n"),e("img",{attrs:{src:a(1118),alt:""}})]),s._v(" "),e("p",[s._v("（3）第三步：查询验证\n"),e("img",{attrs:{src:a(1119),alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(1120),alt:""}})])])}),[],!1,null,null,null);n.default=t.exports}}]);